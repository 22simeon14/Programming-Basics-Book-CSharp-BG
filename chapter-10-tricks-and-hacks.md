# Глава 10. Хитрости и хакове

В настоящата глава ще разгледаме някои хитрости, хакове и техники, които ще улеснят работата ни с езика C# в среда за разработка Visual Studio. По-специално ще се запознаем:

* как правилно да **форматираме код**
* с конвенции за **именуване на елементи от код**
* с някои **бързи клавиши** (keyboard shortcuts)
* с някои **шаблони с код** (code snippets)
* с техники за **дебъгване на код**

## Форматиране на кода

Правилното форматиране на нашия код ще го направи** по-четим и разбираем** в случай, че се наложи някой друг да работи с него. Това е важно, защото в практиката ще ни се наложи да работим в екип с други хора и е от голямо значение дали пишем кода си така, че колегите ни да могат **бързо да се ориентират** в него.
Има определени правила за правилно форматиране на кода, които събрани в едно се наричат **конвенции**. Конвенциите са група от правила, общо приети от програмистите на даден език, и се ползват масово. Тези конвенции помагат за изграждането на норми в дадени езици - как е най-добре да се пише и какви са добрите практики. Приема се, че ако един програмист ги спазва, то кодът му е лесно четим и разбираем.
Езикът C# е направен от **Microsoft** и те са тези, които определят най-добрите практики за писане. Трябва да знаете също така, че дори да не спазвате конвенциите, наложени от **Microsoft**, кодът ви ще работи (стига да е написан правилно), но просто няма да бъде лесно разбираем. Това, разбира се, не е фатално на основно ниво, но колкото по-бързо свикнете да пишете качествен код, толкова по-добре.

За форматиране на кода от Microsoft се препоръчва **къдравите скоби (`{}`)** да са на отделен ред и точно под конструкцията, към която се отнасят, както е в примера по-долу.

```csharp
if (true)
{
    Console.WriteLine("влязох в if-a");
}
```

Вижда се, че командата `Console.WriteLine` в примера е **4 празни полета навътре (един таб)**, което също се препоръчва от **Microsoft**. Също така, ако дадена конструкция с къдрави скоби е един таб навътре, то **къдравите скоби (`{}`)** трябва да са в **началото на конструкцията**, както е в примера по-долу:

```csharp
if (true)
{
   if (true)
   {
       Console.WriteLine("влязох в if-a");
   }
}
```

Ето това е пример за **лошо форматиран код** спрямо общо приетите конвенции за писане на код на езика C#:
   
```csharp
if(true){
Console.WriteLine("влязох в if-a");}
```
Първото, което се забелязва са **къдравите скоби (`{}`)**. Първата (отваряща) скоба трябва да е **точно под `if-условието`**, a втората (затваряща) скоба - **под командата `Console.WriteLine`, на отделен празен ред**. В допълнение, командата вътре в `if-конструкцията` трябва да бъде **4 празни полета навътре (един таб)**. Същото правило важи и за **`for-цикли` и всякакви други конструкции с къдрави скоби (`{}`)**. Ето още няколко примера:

Правилно:
```csharp
for (int i = 0; i < 5; i++)
{
    Console.WriteLine(i);
}
```
Грешно:
```csharp
for(int i=0;i<5;i++){
Console.WriteLine(i);
}
```

За ваше удобство има **бързи клавиши във Visual Studio**, за които ще говорим по-късно в настоящата глава, но засега ни интересуват 2 конкретни комбинации. Едната комбинация е за форматиране на **кода в целия документ**, а другата комбинация - за форматиране на **част от кода**. Ако искаме да форматираме **целия код**, то трябва да натиснем [**CTRL + K + D**]. В случай, че искаме да форматираме само **част от кода**, то ние трябва да **маркираме с мишката частта**, която искаме да форматираме и да натиснем [**CTRL + K + F**].

Нека използваме грешния пример преди малко:
```csharp
for(int i=0;i<5;i++){
Console.WriteLine(i);
}
```
Ако натиснем [**CTRL + K + D**], което е нашата комбинация за форматиране на **целия документ**, ще получим код, форматиран според **общо приетите конвенции за C#**, който ще изглежда по следния начин:

```csharp
for (int i = 0; i < 5; i++)
{
    Console.WriteLine(i);
}
```
Тази комбинация може да ни помогне, ако попаднем на лошо форматирал код.

## Именуване на елементите на кода

В тази подглава ще се фокусираме върху **общо приетите конвенции за именуване на прокети, файлове и променливи наложена от Microsoft.**

### Именуване на проекти и файлове

**За именуване на прокети и файлове** се препоръчва описателно име, което подсказва **каква е ролята** на въпросния файл/проект и в същото време се препоръчва **Upper Camel Case конвенцията**. На кратко това е **конвенция за именуване** на елементи, при която всяка дума, включително първата, започва с **главна буква**. Пример: в този курс се започва с лекция на име **First steps in coding** и следователно едно примерно именуване на проекта (solution) за тази лекция може да бъде **FirstStepsInCoding**. Същата конвенция важи и за файловете в даден проект. Ако вземем за пример първата задача от лекцията **First steps in coding**, тя се казва **Hello World** и следователно нашия файл в проекта ще се казва **HelloWorld**.

### Именуване на променливи

Нещата седят по по-различен начин при променливи. Правилaта за именуване на променливи гласят, че:

* името трябва да е **кратко и описателно** и да обеснява за какво служи дадената променлива.
* трябва да се състои само от буквите **a-z**, **A-Z**, **цифрите 0-9**, както и **символа '\_'**
* в C# е прието променливите да **започват** винаги **с малка буква** и да **съдържат малки букви**, като **всяка следваща дума** в тях **започва с главна буква** (това е още познато като **Lower Camel Case**)
* трябва да се внимава за главни и малки букви, тъй като C# прави разлика между тях. Например **`age`** и **`Age`** са различни променливи.

<table><tr><td><img src="/assets/alert-icon.png" style="max-width:50px" /></td>
<td>Въпреки че е разрешено използването на символа '_' в имената на променливите, се счита за лош стил на именуване.</td>
</tr></table>

Ето няколко примера за **добре именувани** променливи:

* **`firstName`**
* **`age`**
* **`startIndex`**
* **`lastNegativeNumberIndex`**

Ето няколко примера за **лошо именувани променливи**, макар и имената да са коректни от гледна точка на компилатора на C#:

* **`_firstName`** (започва с '_')
* **`last_name`** (съдържа '_')
* **`AGE`** (изписана е с главни букви)
* **`Start_Index`** (започва с главна буква и съдържа '_')
* **`lastNegativeNumber_Index`** (съдържа '_')

Първоначално всички тези правила може да ни се струват безсмислени и ненужни, но с течение на времето и натрупването на опит ще видите нуждата от норми за писане на качествен код, за да може да се работи по-лесно и по-бързо в екип. Ще разберете, че е изключително досадна работата с код, който е написан без да се спазват никакви правила за качествен код.

## Бързи клавиши във Visual Studio

В миналата подглава споменахме за две от комбинациите, които се отнасят за форматиране на код. Едната комбинация [**CTRL + K + D**] беше за **форматиране на целия код в даден файл**, а втората [**CTRL + K + F**] ни служеше в случай, че искаме да **форматираме само дадена част от кода**. Тези комбинации се наричат **бързи клавиши** и сега ще говорим по-подробно за тях.

Бързи клавиши са **комбинации**, които ни предоставят възможността да извършваме някои действия **по-лесно и по-бързо**, като всяка среда за разработка на софтуер си има своите бързи клавиши, въпреки че повечето се повтарят. Сега ще разгледаме някои от **бързите клавиши** във **Visual Studio**.

Eдна подобна комбинация е [**CTRL + F**], **отваряща търсачка**, с която ние можем да **търсим в нашия код**. Този бърз клавиш е широко разпронстранен и може да се ползва и в други среди за разработка, в сайтове и като цяло почти навсякъде. Друга комбинация е [**CTRL + K + C**] - полезна е в случай, че искаме да **закоментираме част от кода си**. Има и друга комбинация, която **разкоментира код** и тя е [**CTRL + K + U**]. В случай, че сме ползвали комбинацията [**CTRL + K + C**] и искаме да **обърнем ефекта**, то ние можем да ползваме друга много полезна комбинация - [**CTRL + Z**]. Тя** връща кода с една промяна назад** (т.нар. Undo). В случай, че имаме **незакоментиран код** и използваме [**CTRL + K + C**], за да закоментираме маркирана част от кода, то при натискане на [**CTRL + Z**] ще се върнем една стъпка назад, където кодът е още **незакоментиран**. Тази команда работи и при писане на код. Аналогът и е [**CTRL + Y**] - т.нар. Redo. Накратко, ако изтрием нещо с [**CTRL + Z**] и не направим промени след това - можем да обърнем ефекта (с комбинацията [**CTRL + Y**]) и да продължим, откъдето започнахме.

Повече за **бързите клавиши във Visual Studio** може да намерите тук: [https://msdn.microsoft.com/en-us/library/da5kh0wa.aspx]
  
## Шаблони с код (code snippets)

Във Visual Studiо съществуват т.нар. **шаблони с код** (code snippets), при изписването на които се генерира шаблон с код. Примерно при изписването на [**`cw` + Tab + Tab**]" се генерира кодът **`Console.WriteLine();`**:

![code](/assets/chapter-10-images/Snippet_CW.jpg)

В тази подглава ще покажем как сами да си **направим собствен шаблон**. Ще разгледаме **как се прави code snippet** за **`Console.ReadLine()`**. Като за начало ще си създадем нов празен проект и ще отидем на [**Tools -> Code Snippet Manager**], както е показано на снимката:

![Tools menu](/assets/chapter-10-images/Tools_CodeSnippetsManager.jpg) 

В отворилия се прозорец трябва да изберем **Language -> CSharp**, а от секцията **Locations -> Visual C#**. Там се намират всички съществуващи шаблони за езика **C#**:

![Snipetts Menu](/assets/chapter-10-images/CodeSnippetsManager.jpg) 

Избираме някой snippet, например `cw`, вземаме пътя му и го отваряме:
![Snipett](/assets/chapter-10-images/CodeSnippet_CW.jpg) 

Виждаме доста непознати неща, но няма страшно, по-нататък ще се запознаем и с тях. Сега се фокусираме върху частта **`<Title><Title>`**, **`<Shortcut><Shortcut>`** и кода между **`CDATA[]`**. Първо ще сменим заглавието, което седи в секцията **`<Title><Title>`** и вместо **`cw`**, ще напишем **`cr`**, като това ще бъде **заглавието на нашия шаблон**. След това, в секцията **`<Shortcut><Shortcut>`**, ще сменим това, което трябва да напишем за **извикването на нашия шаблон** (shortcut) от **`cw`** на **`cr`**. Накрая трябва да сменим кода в **`CDATA[]`**, от **`WriteLine`** на **`ReadLine`**: **`CDATA[$SystemConsole$.ReadLine($end$);]`**. Пожелание може да промените и секциите Description и Author. Промененият файл трябва да изглежда така:

![Snipett](/assets/chapter-10-images/Snippet_CR.jpg) 

След като сме написали нашия snippet, трябва да си **запазим файла във формат** **snippName.snippet** (в нашия случай **cr.snippet**). За да вкараме shortcut комбинацията в Visual Sudio отиваме в **Tools -> Code Snippet Manager -> Import** и избираме **cr.snippet** файла, който създадохме:

![Snipett](/assets/chapter-10-images/CodeSnippetManager_Import.jpg) 

![Snipett](/assets/chapter-10-images/Import_NewSnippet.jpg) 

Вече когато напишем **`cr`** във Visual Studio, **нашият нов snippet** се появява:

![Snipett](/assets/chapter-10-images/NewSnippet_Test.jpg) 

## Техники за дебъгване на кода

Дебъгването играе важна роля в процеса на създаване на софтуер, която ни позволява **постъпково да проследим изпълнението** на нашата програма. С помощта на тази техника можем да **следим стойностите на локалните променливи**, тъй като те се променят по време на изпълнение на програмата, и да **отстраним** евентуални **грешки** (бъгове). Процесът на дебъгване включва:

* **Забелязване** на проблемите (бъговете)
* **Намиране** на кода, който причинява проблемите
* **Оправяне** на кода, причиняващ проблемите, така че програмата да работи правилно
* **Тестване**, за да се убедим, че програмата работи правилно след нанесените корекции

Visual Studio ни предоставя **вграден дебъгер** (debugger), чрез който можем да поставяме **точки на прекъсване** (или breakpoints), на избрани от нас места. При среща на **стопер** (breakpoint), програмата **спира изпълнението** си и позволява **постъпково изпълнение** на останалите редове. Дебъгването ни дава възножност да **вникнем в детайлите на програмата** и да видим къде точно възникват грешките и каква е причината за това.

За да демонстрираме работа с дебъгера ще използваме следната програма:

```csharp
static void Main(string[] args)
{
    for (int i = 0; i < 100; i++)
    {
        Console.WriteLine(i);
    }
}
```

Ще сложим стопер (breakpoint) на функцията **`Console.WriteLine`**. За целта трябва да преместим курсорът на реда, който печата на конзолата, и да натиснем [**F9**]. Появява се **точка на прекъсване**, където програмата ще **спре** изпълнението си:

![Debugger](/assets/chapter-10-images/Debugger_BR.jpg) 

За да стартираме **програмата в режим на дебъгване**, избираме [**Debug**] -> [**Start Debugging**] или натискаме [**F5**]:

![Debugger](/assets/chapter-10-images/Debugger_Menu.jpg) 

След стартиране на програмата, виждаме, че тя **спира изпълнението си** на ред 11, където сложихме стопера (breakpoint). Кодът на текущия ред се **оцветява с жълт цвят** и можем да го **изпълняваме постъпково**. За да преминем на **следващ ред** използваме клавиш [**F10**]. **Забелязваме, че кодът на текущия ред все още не е изпълнен**. **Изпълнява се, когато преминем на следващия ред**:

![Debugger](/assets/chapter-10-images/Debugger_Test.jpg) 

От прозореца **Locals** можем да наблюдаваме **промените по локалните променливи**. За да отворите прозореца изберете [**Debug**] -> [**Windows**] -> [**Locals**].

![Debugger](/assets/chapter-10-images/Debugger_Locals.jpg) 

## Справочник с хитрости

Тази подглава ще съдържа някои основни и полезни неща, разглеждани в тази книгаи:

#### Вкарване на променливи в стринг (string):

```csharp
var text = "some text"
Console.WriteLine("{0}", text);
// това ще изкара на конзолата "some text"
```

В случая използваме placeholder - **`{x}`**, където **x** е число (по-голямо от 0), отговарящо на позицията, на която трябва да поставим променливата. Следователно, ако подаваме 2 променливи ще имаме един placeholder, който ще е **`{0}`** и той ще съдържа стойността на **първата променлива** и още един - **`{1}`**, който ще съдържа стойността на **втората променлива**. Примерно :

```csharp
var text = "some text"
var number = 5;
Console.WriteLine("{0} {1} {0}", text, number);
// това ще изкара "some text 5 some text
```

В този пример забелязваме, че можем да подаваме **не само текстови променливи**, но и числа. Също така можем да използваме дадена променлива **няколко пъти** и за целта в placeholder слагаме числото, което **отговаря на позицията на променливата**. В случая на нулева позиция стои променливата **`text`**, а на първа позиция е променливата **`number`**. Номерацията е объркваща отначало, но трябва да запомните, че в програмирането **броенето започва от 0**.

//TODO:
#### Форматиране с 2 десетични цифри:

```cs
var number = 5.432432
Console.WriteLine(Math.Round(number,2));
//това ще изкара на конзолата "5.43"
```

Math.Round() приема 2 параметъра като първия е числото, което искаме да закръглим и втория параметер е числото, което определя с колко знака след десетичната запетая като това число винаги трябва да бъде цяло число! Ако искаме да закръглим до 2 знака след десетичната запетая и третия знак е по-малък от 3, както в примера по-горе, то втория знак остава непроменен, но ако  третия знак е по-голям от 5 то увеличаваме втория знак с 1, както е в примера по-долу:

```cs
var number = 5.439
Console.WriteLine(Math.Round(number,2));
//това ще изкара на конзолата "5.44"
```

//ТОДО : какво се случва при 5
В случай, че искаме винаги да закръгляме надолу можем вместо Math.Round() да използваме друг метод - Math.Floor(), който винаги закръгля надолу, но също така винаги закръгля до цяло число. Ако имаме числото 5.99 и използваме Math.Floor(5.99) то ние ще получим числото 5. Можем и да направим точно обратното - винаги да закръгляме нагоре, използвайки метода Math.Ceiling(). Отново ако имаме число примерно 5.11 и използваме Math.Ceiling(5.11) то ние ще получим 6. Това е показано и в примерите по-долу:

```cs
var numberToFloor = 5.99;
var numberToCeiling = 5.11;
Console.WriteLine(Math.Floor(numberToFloor));//това ще изкара на конзолата 5
Console.WriteLine(Math.Ceiling(numberToCiling));//това ще изкара на конзолата 6
```
Също е възможно да използваме плейсхолдър

```cs
var num = 5.432424";
Console.WriteLine("{0:f2}",num);
```
В случая след числото добавяме ":f2", което ще ограничи числото ни до 2 знака след десетичната запетая и ще работи като Math.Round() като трябва да имаме в предвид, че числото означваа колко знака искаме след десетичната запетая и може да е "f3" или "f5".
&nbsp;&nbsp; **Как се прави цикъл**
<p>Има различни видове цикли,чиято работа е да минават през даден код определен брой пъти, но ние ще се фокусираме върху for циклите на които е отделена цяла глава, която можете да видите за допълнителна информация ТОДО:Коя беше главата?
За един for цикъл ни трябват няколко неща - декларация на брояч, който брои колко пъти се върти цикъла, проверка с дадено условие дали брояча е валиден и промяна на брояча. Тези неща се слагат в обикновени скоби"()" разделени едно от друго с точка и запетая ";" и след тях следват две къдрави скоби "{}". Всичко това можете да видите как изглежда в примера по-долу:</p>

```cs
for(var i = 0; i < 5; i++;)
{

}
```

Много е важно да не забравите да затворите къдравите скоби или да напишете всички точки и запетайки (;). За да направите един for цикъл ви трябват общо 3 точки и запетайки (;). Една след декларацията на брояча, една след проверката дали брояча отговаря на дадено условие и една след промяната на брояча!
&nbsp;&nbsp; **Как сe прави if проверка**
За да направим една единствена if проверка ни трябва "if()" и между скобите някаква проверка като примерно "5 == 5", но за да работи трябва да запомните, че се използва двоен знак за равенство (==). Единичния знак за равенство се използва за присвояване, а двойния за проверка дали две неща са еднакви.

```cs
if(5==5)
{

}
```
В допълнение можем да направим if проверка и ако искаме да се случи конректно нещо, ако проверката е грешна то можем да добавим else. По този начин ще обхванем всички възможни случаи, които са два - в единия случай ще влезем в if проверката и във втория случай всичко, което не влезе в проверката. Това се нарича if-else конструкция. Специфичното при нея е, че else няма обикновени скоби или условие. То е просто else думата с две къдрави скоби.

```cs
if(5==5)
{

}
else
{

}
```
Има и трети начин за построяване на конструкция - if-else if. В този случай имаме "if" проверка и след нея още if проверки, но с думата "else" преди тях като само ако предишната проверка е грешна ще се стигне до следващата. Накрая бихме могли дори да добавим "else" за да сме сигурни, че сме обхванали всички възможности

```cs
if(4==5)
{

}
else if(3==5)
{

}
else if(2==5)
{

}
else
{

}
```

TODO: Cheat sheet: така се прави цикъл, така се прави проверка, така се форматира с 2 десетични цифри, ...


## Какво научихме от тази глава?

В настоящата глава се запознахме с някои хитрости, хакове, техники и инструменти за по-ефективно писане на код, решаване на задачи и откриване и отстраняване на грешки в кода. Ако не сте ги пробвали, поиграйте си с тях, защото те помагат на програмистите да бъдат ефективни и да пишат по-качествен софтуер.
